# Определение положения поезда путем подсчета железнодорожных креплений по видео

Команда №6

Проектный практикум №21/ЛКП-1235-2023

Цель проекта: Создание системы для определения положения поезда путем подсчета шпал по готовым видеоматериалам съемки движения.

Участники:
* Паньков Лев РИМ-120990
* Маркин Михаил РИМ-120907
* Соломеин Александр РИМ-120907
* Зенков Мирослав РИМ-120906

Принцип работы:
* Пользователь загружает видео mp4 через форму;
* Видео обрабатывается на стороне бэкенда;
* Пользователь получает информацию о движении поезда и видео с распознанными креплениями.

## Методы API

### Отправка видео 

Принимается видео mp4 формата с соответствующим mimetype

`@router.post("/upload")`

Пример ответа:
```  
{
  "hash": 8729932479735
}
``` 
Где hash - хэш по которому сохраняется файл

### Проверка статуса обработки видео

`@router.get('/status/{file_hash}')`

Где file_hash - хэш полученный из ответа `/upload`

Пример ответа:
```  
{
  "status": "FINISH"
}
```

### Получение информации о движении

`@router.get('/statistics/{file_hash}')`

Где file_hash - хэш полученный из ответа `/upload`

Пример ответа:
```  
{
  "total_distance": 0.84,
  "avg_speed": 1.01,
  "ride_time": 0.83,
  "mounts_count": 3
}
```
Где _total_distance_ - пройденный путь в метрах, 
_avg_speed_ - средняя скорость на всем пути в м/с, 
_ride_time_ - время движения поезда в секундах (от начала движения до остановки),
_mounts_count_ - количество обнаруженных креплений.

### Получение видео

`@router.get('/download/{file_hash}')`

Где file_hash - хэш полученный из ответа `/upload`

В ответ высылается файл размеченного видео

## Запуск в Docker

`docker-compose build && docker-compose up`

## Запуск локально

### Запуск backend

Находясь в корневой директории выполнить команды:

`cd backend`
`uvicorn backend.main:app`

### Запуск web

Заменить в файле web/main.py строку

`HOST = 'http://backend:8000'` на `HOST = 'http://127.0.0.1:8000'`

Находясь в корневой директории выполнить команды:

`streamlit run web/main.py`